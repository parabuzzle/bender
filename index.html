<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="Bender : Bender is the IRC bot container that runs on Spunk">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Bender</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/parabuzzle/bender">View on GitHub</a>

          <h1 id="project_title">Bender</h1>
          <h2 id="project_tagline">Bender is the IRC bot container that runs on Spunk</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/parabuzzle/bender/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/parabuzzle/bender/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p><a href="https://waffle.io/parabuzzle/bender"><img src="https://badge.waffle.io/parabuzzle/bender.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a></p>

<h1>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span class="octicon octicon-link"></span></a>Install</h1>

<p><strong>Grab Application</strong></p>

<pre><code>$ git clone git://github.com/parabuzzle/bender.git
</code></pre>

<p><strong>Install Gems</strong></p>

<pre><code>$ bundle install
</code></pre>

<p><strong>Run It</strong></p>

<pre><code>$ cd bender
$ ruby bin/server.rb
</code></pre>

<p><em>note: you can also use foreman to run it: <code>foreman start</code></em></p>

<h2>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span class="octicon octicon-link"></span></a>Configuration</h2>

<p>Look at <code>config/application.rb</code> for a list of configuration options and overrides</p>

<p><em>note: Bender is 100% Heroku compatible and configurable via the ENV - <a href="https://github.com/parabuzzle/bender/wiki/Using-Bender-on-Heroku">https://github.com/parabuzzle/bender/wiki/Using-Bender-on-Heroku</a></em></p>

<h1>
<a id="extending-bender" class="anchor" href="#extending-bender" aria-hidden="true"><span class="octicon octicon-link"></span></a>Extending Bender</h1>

<p><em>Let's face it... this is what you're interested in ;)</em></p>

<p>The full (up-to-date) api docs can be found here: <a href="http://www.rubydoc.info/github/parabuzzle/bender">http://www.rubydoc.info/github/parabuzzle/bender</a></p>

<h3>
<a id="directory-structure" class="anchor" href="#directory-structure" aria-hidden="true"><span class="octicon octicon-link"></span></a>Directory Structure</h3>

<pre><code>./config/       # config and initialization
./lib/          # directory with all support libraries (classes/modules)
./processors/   # directory for irc command processors
./servlets/     # directory for servlets
</code></pre>

<h3>
<a id="autoloader" class="anchor" href="#autoloader" aria-hidden="true"><span class="octicon octicon-link"></span></a>Autoloader</h3>

<p>When Bender starts, it auto loads everything so that you just put your extensions in the proper folders with the proper namespacing and restart the application for it to start working. NO EXTRA CONFIG!</p>

<p><strong>Load Order</strong></p>

<ol>
<li>Require ./config/application.rb</li>
<li>Require all files in ./config/*.rb</li>
<li>Require all files in ./lib/*.rb</li>
<li>Require all files in ./servlets/*.rb</li>
<li>Require all files in ./processors/*.rb</li>
<li>Start processors - ./processors/*_processor.rb</li>
<li>Start servlets - ./servlets/*_servlet.rb</li>
</ol>

<p><strong>Autoload of Processors</strong></p>

<p>This is done via the <code>Bender::Processor</code> namespace. As long as your processor's class is namespaced there, it will be loaded.</p>

<p>example:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-s3">Bender</span>::<span class="pl-s3">Processor</span>::<span class="pl-vo">BasicProcessor</span> <span class="pl-c">#=&gt; loaded</span>
<span class="pl-s3">Bender</span>::<span class="pl-s3">Processor</span>::<span class="pl-vo">AwesomeSauce</span>   <span class="pl-c">#=&gt; loaded</span>
<span class="pl-s3">Bender</span>::<span class="pl-vo">WizBangProcessor</span>          <span class="pl-c">#=&gt; not loaded</span></pre></div>

<p><strong>Autoload of Servlets</strong></p>

<p>This is done via the <code>Bender::HTTP</code> namespace. As long as your servlet's class is namespaced there, it will be loaded.</p>

<p>example:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-s3">Bender</span>::<span class="pl-s3">HTTP</span>::<span class="pl-vo">PingServlet</span>  <span class="pl-c">#=&gt; loaded</span>
<span class="pl-s3">Bender</span>::<span class="pl-s3">HTTP</span>::<span class="pl-vo">Github</span>       <span class="pl-c">#=&gt; loaded</span>
<span class="pl-s3">Bender</span>::<span class="pl-vo">MyServlet</span>          <span class="pl-c">#=&gt; not loaded</span></pre></div>

<p><strong>More info about creating processors and servlets in the next section</strong></p>

<h3>
<a id="building-an-irc-command-processor" class="anchor" href="#building-an-irc-command-processor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building an irc command processor</h3>

<p>Just subclass <code>Bender::BaseProcessor</code> and implement the <code>#process</code> method</p>

<p><strong>This is what a processor looks like:</strong></p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">module</span> <span class="pl-en"><span class="pl-e">Bender::</span>Processor</span>
  <span class="pl-k">class</span> <span class="pl-en">BasicProcessor<span class="pl-e"> &lt; Bender::BaseProcessor</span></span>

    <span class="pl-c"># REQUIRED! You must implement the #process method when subclassing the BaseProcessor class</span>
    <span class="pl-k">def</span> <span class="pl-en">process</span>

      <span class="pl-c">#monitor for the word 'sweet' and respond with 'dude'</span>
      hear(<span class="pl-sr"><span class="pl-pds">/</span>sweet<span class="pl-pds">/i</span></span>) { reply <span class="pl-s1"><span class="pl-pds">'</span>Dude!<span class="pl-pds">'</span></span> }

      <span class="pl-c"># monitor for my nickname with or without a question mark and respond</span>
      <span class="pl-c">#   ie: `bender?` responds with 'Kiss my shiny metal ass'</span>
      hear(<span class="pl-sr"><span class="pl-pds">/</span>^<span class="pl-pse">#{</span><span class="pl-s2"><span class="pl-vo">@bot</span>.nickname</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-cce">\?</span>?$<span class="pl-pds">/</span></span>) { reply <span class="pl-s1"><span class="pl-pds">'</span>Kiss my shiny metal ass<span class="pl-pds">'</span></span> }

      <span class="pl-c"># respond wraps the previous bot.nickname catching and matches on everything after the nickname</span>
      <span class="pl-c">#   ie: `bender PING` will respond with 'PONG'</span>
      respond(<span class="pl-sr"><span class="pl-pds">/</span>PING$<span class="pl-pds">/</span></span>) { reply <span class="pl-s1"><span class="pl-pds">"</span>PONG<span class="pl-pds">"</span></span> }
    <span class="pl-k">end</span>

    <span class="pl-c"># The #help class method is optional but it makes running `bender help` a lot more useful ;)</span>
    <span class="pl-c"># This method should return an array of lines to be printed in the irc</span>
    <span class="pl-k">def</span> <span class="pl-en">self.help</span>
      [
        <span class="pl-s1"><span class="pl-pds">"</span>sweet - replies with 'dude'<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pse">#{</span><span class="pl-s2"><span class="pl-s3">Bender</span>.nickname</span><span class="pl-pse"><span class="pl-s2">}</span></span> PING - replies with 'PONG'<span class="pl-pds">"</span></span>,
        <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-pse">#{</span><span class="pl-s2"><span class="pl-s3">Bender</span>.nickname</span><span class="pl-pse"><span class="pl-s2">}</span></span>? - replies with 'Kiss my shiny metal ass<span class="pl-pds">"</span></span>
      ]
    <span class="pl-k">end</span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>You simply put this code in the <code>./processors/</code> directory and restart Bender for this to start working.</p>

<h3>
<a id="building-a-servlet" class="anchor" href="#building-a-servlet" aria-hidden="true"><span class="octicon octicon-link"></span></a>Building a servlet</h3>

<p>Since Bender uses webrick, creating a servlet for Bender is almost the same as creating an Abstract Servlet in Webrick. <strong>ALMOST</strong>... The only difference is that Bender will provide the Spunk Bot object so that you can access the Spunk IRC bot from within the request to post messages to IRC or display IRC data to a webpage. This is done by inheriting from the <code>Bender::BaseServlet</code> class which has the bot.</p>

<p><strong>This is what servlet looks like</strong></p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">class</span> <span class="pl-en">GitServlet<span class="pl-e"> &lt; Bender::BaseServlet</span></span>
  <span class="pl-c"># Provides a simple bridge of github url post hook data to IRC</span>
  <span class="pl-c"># http://localhost:9091/gitirc?room=github</span>

  <span class="pl-c"># REQUIRED! so Bender knows where to mount this</span>
  <span class="pl-k">def</span> <span class="pl-en">self.mountpoint</span>
    <span class="pl-s1"><span class="pl-pds">"</span>/gitirc<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">do_GET</span>(<span class="pl-vpf">request</span>, <span class="pl-vpf">response</span>)
    status <span class="pl-k">=</span> <span class="pl-c1">200</span>
    content_type <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>text/html<span class="pl-pds">"</span></span>
    body <span class="pl-k">=</span> <span class="pl-s1"><span class="pl-pds">"</span>bender version <span class="pl-pse">#{</span><span class="pl-s2"><span class="pl-vo">BENDER_VERSION</span></span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
    body <span class="pl-k">+=</span> <span class="pl-s1"><span class="pl-pds">"</span><span class="pl-cce">\n</span><span class="pl-pds">"</span></span>

    response.status <span class="pl-k">=</span> status
    response[<span class="pl-s1"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> content_type
    response.body <span class="pl-k">=</span> body
    response.body <span class="pl-k">=</span> body
  <span class="pl-k">end</span>

  <span class="pl-k">def</span> <span class="pl-en">do_POST</span>(<span class="pl-vpf">request</span>, <span class="pl-vpf">response</span>)
    status, content_type, body <span class="pl-k">=</span> post_to_irc(request)

    response.status <span class="pl-k">=</span> status
    response[<span class="pl-s1"><span class="pl-pds">'</span>Content-Type<span class="pl-pds">'</span></span>] <span class="pl-k">=</span> content_type
    response.body <span class="pl-k">=</span> body
  <span class="pl-k">end</span>

  <span class="pl-k">private</span>

  <span class="pl-k">def</span> <span class="pl-en">post_to_irc</span>(<span class="pl-vpf">request</span>)
    bot_hash <span class="pl-k">=</span> {<span class="pl-c1">:rooms</span>=&gt;[], <span class="pl-c1">:payload</span>=&gt;<span class="pl-c1">nil</span>}
    request.query.collect <span class="pl-k">do </span>|<span class="pl-vo">key</span>,<span class="pl-vo">value</span>|
      <span class="pl-k">if</span> key.match(<span class="pl-sr"><span class="pl-pds">/</span>^room<span class="pl-pds">/</span></span>)
        bot_hash[<span class="pl-c1">:rooms</span>] <span class="pl-k">&lt;&lt;</span> <span class="pl-s1"><span class="pl-pds">'</span>#<span class="pl-pds">'</span></span> <span class="pl-k">+</span> value
      <span class="pl-k">end</span>
      <span class="pl-k">if</span> key.match(<span class="pl-sr"><span class="pl-pds">/</span>^payload<span class="pl-pds">/</span></span>)
        bot_hash[<span class="pl-c1">:payload</span>] <span class="pl-k">=</span> value
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>
    rooms <span class="pl-k">=</span> bot_hash[<span class="pl-c1">:rooms</span>]
    rooms.uniq!

    <span class="pl-k">if</span> bot_hash[<span class="pl-c1">:payload</span>]
      j <span class="pl-k">=</span> <span class="pl-s3">JSON</span>.parse(bot_hash[<span class="pl-c1">:payload</span>])
      repo <span class="pl-k">=</span> j[<span class="pl-s1"><span class="pl-pds">'</span>repository<span class="pl-pds">'</span></span>][<span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]
      compare <span class="pl-k">=</span> j[<span class="pl-s1"><span class="pl-pds">'</span>compare<span class="pl-pds">'</span></span>]
      pusher <span class="pl-k">=</span> j[<span class="pl-s1"><span class="pl-pds">'</span>pusher<span class="pl-pds">'</span></span>][<span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]
      owner <span class="pl-k">=</span> j[<span class="pl-s1"><span class="pl-pds">'</span>repository<span class="pl-pds">'</span></span>][<span class="pl-s1"><span class="pl-pds">'</span>owner<span class="pl-pds">'</span></span>][<span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]
      branch <span class="pl-k">=</span> j[<span class="pl-s1"><span class="pl-pds">'</span>ref<span class="pl-pds">'</span></span>]
      <span class="pl-k">unless</span> pusher <span class="pl-k">==</span> <span class="pl-s1"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span>
        rooms.each <span class="pl-k">do </span>|<span class="pl-vo">r</span>|
          <span class="pl-k">unless</span> <span class="pl-vo">$bot</span>.joined_rooms.include? r
            <span class="pl-vo">@bot</span>.join_room r
          <span class="pl-k">end</span>
          <span class="pl-vo">@bot</span>.say r, <span class="pl-s1"><span class="pl-pds">"</span>[git-push] <span class="pl-pse">#{</span><span class="pl-s2">pusher</span><span class="pl-pse"><span class="pl-s2">}</span></span> pushed to <span class="pl-pse">#{</span><span class="pl-s2">owner</span><span class="pl-pse"><span class="pl-s2">}</span></span>/<span class="pl-pse">#{</span><span class="pl-s2">repo</span><span class="pl-pse"><span class="pl-s2">}</span></span> [ref: <span class="pl-pse">#{</span><span class="pl-s2">branch</span><span class="pl-pse"><span class="pl-s2">}</span></span>]<span class="pl-pds">"</span></span>
          <span class="pl-vo">@bot</span>.say r, <span class="pl-s1"><span class="pl-pds">"</span>[git-push] <span class="pl-pse">#{</span><span class="pl-s2">compare</span><span class="pl-pse"><span class="pl-s2">}</span></span><span class="pl-pds">"</span></span>
        <span class="pl-k">end</span>
      <span class="pl-k">end</span>
    <span class="pl-k">end</span>

    <span class="pl-k">return</span> <span class="pl-c1">200</span>, <span class="pl-s1"><span class="pl-pds">"</span>text/plain<span class="pl-pds">"</span></span>, <span class="pl-s1"><span class="pl-pds">"</span>accepted<span class="pl-pds">"</span></span>
  <span class="pl-k">end</span>
<span class="pl-k">end</span></pre></div>

<p>This servlet will listen for a post from your github post hook on your repo and bridge the data into the room provided. <em>ie - <a href="http://myserver.com:9019/gitirc?room=github">http://myserver.com:9019/gitirc?room=github</a> will post to the #github room whenever you push to your repo</em></p>

<p>This code should be put into the <code>./servlets/</code> directory to get included at startup.</p>

<h1>
<a id="contributing" class="anchor" href="#contributing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing</h1>

<ol>
<li>fork the repository</li>
<li>create a feature branch</li>
<li>add your awesome code</li>
<li>send a pull request</li>
<li>have a beer</li>
</ol>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h1>

<p>The MIT License (MIT)</p>

<p>Copyright (c) 2013-2015 Michael Heijmans</p>

<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Bender maintained by <a href="https://github.com/parabuzzle">parabuzzle</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
